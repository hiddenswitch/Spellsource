plugins {
    id 'java-library'
    id 'idea'
    id 'com.bmuschko.docker-remote-api' version '6.6.1'
}

apply plugin: 'idea'
apply plugin: 'maven'
apply plugin: 'java-library'
apply plugin: 'com.bmuschko.docker-remote-api'

import com.bmuschko.gradle.docker.tasks.image.*

repositories {
    jcenter()
}

dependencies {
    api "org.testcontainers:testcontainers"
    api "org.testcontainers:toxiproxy"
    // https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-databind
    implementation "com.fasterxml.jackson.core:jackson-databind:$jacksonDatabindVersion"
    implementation "com.fasterxml.jackson.dataformat:jackson-dataformat-yaml:$jacksonDatabindVersion"
}

task createPostgresImage(type: DockerBuildImage) {
    inputDir.set(new File("$project.projectDir/src/main/resources/docker/postgres"))
    quiet.set(true)
    images.set(["doctorpangloss/postgres:latest"])
}

task createKeycloakImage(type: DockerBuildImage) {
    inputDir.set(new File("$project.projectDir/src/main/resources/docker/keycloak"))
    quiet.set(true)
    images.set(["doctorpangloss/keycloak:latest"])
}

compileJava {
    // you won't really be able to use the postgres image unless you build it
    dependsOn += [createPostgresImage, createKeycloakImage]
    options.warnings = false
}

java {
    sourceCompatibility(JavaVersion.VERSION_1_8)
}